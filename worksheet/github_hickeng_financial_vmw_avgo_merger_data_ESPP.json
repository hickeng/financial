{"sheet":1,"id":"_","name":"ESPP","conditional_formatting":{"type":"bool","criteria":"NUMBER_NOT_EQUAL_TO","args":["=ROUND(AF7,3)","=AA7",0,0,0],"ranges":["M7:M27","AM7:AM27","AL7:AL27","AL7:AL27","O7:O27"],"effect":["background: #FCE5CD","background: #A2C4C9","background: #D0E0E3","background: #FCE5CD"]}},
{"sheet":1,"id":"A1","data":"Input"},
{"sheet":1,"id":"A2","data":"From ESPP purchase confirmation docs"},
{"sheet":1,"id":"A4","data":"Purchase Begin Date"},
{"sheet":1,"id":"A7","type":"formula","format":"iso-date","propagate":{"end":"A26"},"dataclass":"in_ref"},
{"sheet":1,"id":"A27","format":"iso-date","dataclass":"in_ref"},
{"sheet":1,"id":"B3","data":"Input "},
{"sheet":1,"id":"B4","data":"1970-01-01","format":"iso-date"},
{"sheet":1,"id":"B7","data":"2012-08-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B8","data":"2013-02-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B9","data":"2013-08-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B10","data":"2014-02-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B11","data":"2014-08-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B12","data":"2015-02-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B13","data":"2015-08-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B14","data":"2016-02-01","format":"iso-date","propagate":{"end":"B15"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B16","data":"2017-02-01","format":"iso-date","propagate":{"end":"B17"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B18","data":"2018-03-01","format":"iso-date","propagate":{"end":"B19"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B20","data":"2019-03-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B21","data":"2019-09-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B22","data":"2020-03-01","format":"iso-date","propagate":{"end":"B23"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B24","data":"2021-03-01","format":"iso-date","propagate":{"end":"B25"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B26","data":"2022-03-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B27","data":"1970-01-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C4","data":"Purchase Date"},
{"sheet":1,"id":"C7","data":"2013-01-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C8","data":"=DATE(YEAR(C7),MONTH(C7)+6,DAY(C7))","type":"formula","format":"iso-date","propagate":{"end":"C10"},"dataclass":"in_prepop"},
{"sheet":1,"id":"C11","data":"2015-01-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C12","data":"=DATE(YEAR(C11),MONTH(C11)+6,DAY(C11))","type":"formula","format":"iso-date","propagate":{"end":"C14"},"dataclass":"in_prepop"},
{"sheet":1,"id":"C15","data":"2017-01-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C16","data":"2017-07-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C17","data":"2018-02-28","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C18","data":"2018-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C19","data":"2019-02-28","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C20","data":"2019-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C21","data":"2020-02-29","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C22","data":"2020-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C23","data":"2021-02-28","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C24","data":"2021-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C25","data":"2022-02-28","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C26","data":"2022-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C27","data":"1970-01-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"D4","data":"Shares Purchased","note":"This is the value from \"Shares Purchased\" and NOT from \"Total shares Purchased for Offering\""},
{"sheet":1,"id":"D5","data":"=SUM(D7:D27)","type":"formula","format":"int","dataclass":"info"},
{"sheet":1,"id":"D7","format":"int","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"propagate":{"end":"D27"},"dataclass":"in"},
{"sheet":1,"id":"D29","data":"=D5","type":"formula","format":"int","dataclass":"info"},
{"sheet":1,"id":"E4","data":"Grant Date Market Value"},
{"sheet":1,"id":"E7","data":"89","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E8","data":"78.79","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E9","data":"82.1","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E10","data":"90.14","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E11","data":"98.33","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E12","data":"77.1","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E13","data":"89.13","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E14","data":"45.49","format":"financial","propagate":{"end":"E15"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E16","data":"87.19","format":"financial","propagate":{"end":"E17"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E18","data":"123.66","format":"financial","propagate":{"end":"E19"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E20","data":"178.2","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E21","data":"141.44","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E22","data":"120.52","format":"financial","propagate":{"end":"E23"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E24","data":"140.41","format":"financial","propagate":{"end":"E25"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E26","data":"115.91","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E27","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F4","data":"Purchase Value per Share"},
{"sheet":1,"id":"F7","data":"76.48","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F8","data":"82.19","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F9","data":"90.14","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F10","data":"99.36","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F11","data":"77.1","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F12","data":"89.13","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F13","data":"45.75","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F14","data":"72.98","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F15","data":"87.54","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F16","data":"92.71","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F17","data":"131.75","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F18","data":"153.26","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F19","data":"171.81","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F20","data":"141.44","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F21","data":"120.52","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F22","data":"144.44","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F23","data":"138.21","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F24","data":"148.87","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F25","data":"117.32","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F26","data":"116.03","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F27","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"G4","data":"Current Contributions"},
{"sheet":1,"id":"G7","format":"financial","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"propagate":{"end":"G27"},"dataclass":"in"},
{"sheet":1,"id":"H3","data":"Derived - informational only"},
{"sheet":1,"id":"H4","data":"Total Price"},
{"sheet":1,"id":"H5","data":"=SUM(H7:H27)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"H7","data":"=D7*L7","type":"formula","format":"financial","propagate":{"end":"H26"},"dataclass":"info"},
{"sheet":1,"id":"H27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"H29","data":"=H5","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"I3","data":"Derived - should match vlaues from ESPP purchase confirmation"},
{"sheet":1,"id":"I4","data":"Previous Carry Forward"},
{"sheet":1,"id":"I7","format":"financial","dataclass":"in","note":"Put the Previous Carry Forward form your earliest ESPP confirmation for shares you still own into this cell and it'll propagate down.\nIt doesn't matter that it's on a different row as it's only when you start purchasing shares that it'll have an effect.\nAlternatively you can 0 those rows for which you don't have a purchase and enter your earliest Carry Forward into the precise row."},
{"sheet":1,"id":"I8","data":"=K7","type":"formula","format":"financial","propagate":{"end":"I26"},"dataclass":"in_prepop"},
{"sheet":1,"id":"I27","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"J4","data":"Total Contributions"},
{"sheet":1,"id":"J7","data":"=I7+G7","type":"formula","format":"financial","propagate":{"end":"J26"},"dataclass":"info"},
{"sheet":1,"id":"J27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"K4","data":"Carry Forward"},
{"sheet":1,"id":"K7","data":"=J7-H7","type":"formula","format":"financial","propagate":{"end":"K26"},"dataclass":"info"},
{"sheet":1,"id":"K27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"L4","data":"Purchase Price per Share"},
{"sheet":1,"id":"L7","data":"=0.85*MIN(E7,F7)","type":"formula","format":"int_4dp","propagate":{"end":"L13"},"dataclass":"info"},
{"sheet":1,"id":"L14","data":"=ROUND(0.85*MIN(E14,F14),2)","type":"formula","format":"int_2dp","propagate":{"end":"L26"},"dataclass":"info"},
{"sheet":1,"id":"L27","format":"int_2dp","dataclass":"info"},
{"sheet":1,"id":"M2","data":"From eTrade","format":"int_3dp"},
{"sheet":1,"id":"M3","data":"Input - alternate for cross check","format":"int_3dp"},
{"sheet":1,"id":"M4","data":"AVGO qty from eTrade","format":"int_3dp","note":"This is an optional input.\n\nYou can use it to:\na. track the qty that etrade assocaited with the lot\nb. use a derived per-lot ratio for cash/stack from etrade's number by setting the \"Cash/stock ratio\" tweak on the Summary page to \"Pro-rata - from eTrade share qty\"\n\nThis is the quantities of converted shares from eTrade lots as reported by eTrade. The colour of the cell will alter slightly if the value here does not equal the value calculated via AVGO ratio.\n\nYou can toggle whether to use this manual value or the calculated value in the Tweaks on the first Sheet.\n\nIf this is the lot from which a fraction was taken by etrade then you should add then fractional AVGO quantity back into this value and check the Fraction box. See the note on the fraction column."},
{"sheet":1,"id":"M5","data":"=SUM(M7:M27)","type":"formula","format":"int_3dp","dataclass":"info"},
{"sheet":1,"id":"M7","format":"int_3dp","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"propagate":{"end":"M27"},"dataclass":"in_opt"},
{"sheet":1,"id":"M29","data":"=M5","type":"formula","format":"int_3dp","dataclass":"info"},
{"sheet":1,"id":"N4","data":"Use for fraction","format":"int_3dp","note":"Almost everyone will have a fractional AVGO share after conversion. For many people this is take from their oldest or newest lot. \n\nCheck the box for the lot the fraction was taken from and add the fractional amount back into to \"AVGO qty from eTrade\" column.\nSee the usage docs for details on how to determine the appropriate lot\n\nhttps://github.com/hickeng/financial/blob/main/usage.md#factional-share\n\n\nNotes:\nIf the fractional share should come out of a specific lot, or set of lots, check those lots here. If multiple are selected the sheet will spread the fraction equally over those lots, accounting for differences in cost-basis.\n\nIf it came out of an ESPP lot, that's a sale and will incur the ordinary income portion of tax shown in column \"Income & short term gain\".\n\nThe fractional quantity should be added back into \"AVGO qty from eTrade\" column for the lot that eTrade took it from.\nThis is done because we need the cost-basis of the lot calculated _before_ that fraction is removed as it's a serial conversion - convert entire lot, THEN sell factional part. It also avoids substantial complexity in formulae.\n"},
{"sheet":1,"id":"N5","data":"=COUNTIF(N7:N27, TRUE)","type":"formula"},
{"sheet":1,"id":"N7","type":"checkbox","format":"int_3dp","validation":{"type":"CHECKBOX","enforced":false,"help":""},"propagate":{"end":"N26"},"dataclass":"in"},
{"sheet":1,"id":"N27","format":"int_3dp","dataclass":"in"},
{"sheet":1,"id":"N29","data":"=N5","type":"formula"},
{"sheet":1,"id":"O2","format":"int_3dp"},
{"sheet":1,"id":"O3","data":"1099-B ","format":"int_3dp"},
{"sheet":1,"id":"O4","data":"Proceeds (1d)","format":"int_3dp"},
{"sheet":1,"id":"O7","format":"financial","propagate":{"end":"O27"},"dataclass":"in_opt"},
{"sheet":1,"id":"P2","format":"int_3dp"},
{"sheet":1,"id":"P4","data":"Cost or Other Basis (1e)","format":"int_3dp","note":"Pre-filled with 0.00 because that's what eTrade has reported for everyone."},
{"sheet":1,"id":"P7","format":"financial","propagate":{"end":"P27"},"dataclass":"in_opt"},
{"sheet":1,"id":"Q2","format":"int_3dp"},
{"sheet":1,"id":"Q4","data":"Accrued Market Discount (1f)","format":"int_3dp"},
{"sheet":1,"id":"Q7","format":"financial","propagate":{"end":"Q27"},"dataclass":"in_opt"},
{"sheet":1,"id":"R2","format":"int_3dp"},
{"sheet":1,"id":"R4","data":"Wash Sale Loss Disallowed (1g)","format":"int_3dp"},
{"sheet":1,"id":"R7","format":"financial","propagate":{"end":"R27"},"dataclass":"in_opt"},
{"sheet":1,"id":"S2","format":"int_3dp"},
{"sheet":1,"id":"S4","data":"Gain/Loss Amount","format":"int_3dp"},
{"sheet":1,"id":"S7","format":"financial","propagate":{"end":"S27"},"dataclass":"in_opt"},
{"sheet":1,"id":"T2","format":"int_3dp"},
{"sheet":1,"id":"T4","data":"Federal Income Tax Withheld (4)","format":"int_3dp"},
{"sheet":1,"id":"T7","format":"financial","propagate":{"end":"T27"},"dataclass":"in_opt"},
{"sheet":1,"id":"U2","format":"int_3dp"},
{"sheet":1,"id":"U3","data":"Ratio (shares)","format":"int_3dp"},
{"sheet":1,"id":"U4","data":"Derived from manual share qty","format":"int_3dp","note":"This value is calculated from the VMW -> AVGO ratio for the lot\n"},
{"sheet":1,"id":"U7","data":"=iferror(M7/(0.252*D7),0)","type":"formula","format":"int_6dp","propagate":{"end":"U26"},"dataclass":"info"},
{"sheet":1,"id":"U27","format":"int_6dp","dataclass":"info"},
{"sheet":1,"id":"V4","data":"Manual per-lot","format":"int_3dp","note":"Manual user entry per lot if using a per-lot election instead of pro-rata\n"},
{"sheet":1,"id":"V7","data":"=SWITCH(W7,\"cash\",Reference!$E$5,\"shares\",Reference!$E$6,\"balance\",Reference!$E$7,\"pro-rata\",Reference!$B$5)","type":"formula","format":"int_6dp","propagate":{"end":"V26"},"dataclass":"info"},
{"sheet":1,"id":"V27","format":"int_6dp","dataclass":"info"},
{"sheet":1,"id":"W4","data":"Prefer","format":"int_3dp"},
{"sheet":1,"id":"W7","type":"dropdown","format":"int_6dp","validation":{"type":"VALUE_IN_LIST","values":["balance","cash","shares","pro-rata"],"enforced":true,"help":""},"propagate":{"end":"W27"},"dataclass":"in_opt"},
{"sheet":1,"id":"X1","data":"Output"},
{"sheet":1,"id":"X2","data":"Calculated"},
{"sheet":1,"id":"X3","data":"Cash received"},
{"sheet":1,"id":"X4","data":"eTrade pro-rata"},
{"sheet":1,"id":"X5","data":"=SUM(X7:X27)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"X7","data":"=LET(numVmwShares,D7, cashRatio,Reference!$B$4, vmwFinalPrice,Reference!$B$3, numVmwShares * cashRatio * vmwFinalPrice)","type":"formula","format":"int_4dp","propagate":{"end":"X26"},"dataclass":"info"},
{"sheet":1,"id":"X27","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"X29","data":"=X5","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"Y4","data":"derived eTrade per-lot"},
{"sheet":1,"id":"Y5","data":"=SUM(Y7:Y27)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"Y7","data":"=iferror(LET(numVmwShares,$D7, stockRatio,U7, vmwFinalPrice,Reference!$B$3, (1 - stockRatio) * vmwFinalPrice * numVmwShares),0)","type":"formula","format":"int_4dp","propagate":{"end":"Y26"},"dataclass":"info"},
{"sheet":1,"id":"Y27","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"Y29","data":"=Y5","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"Z4","data":"manual per-lot"},
{"sheet":1,"id":"Z5","data":"=SUM(Z7:Z27)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"Z7","data":"=iferror(LET(numVmwShares,$D7, stockRatio,V7, vmwFinalPrice,Reference!$B$3, (1 - stockRatio) * vmwFinalPrice * numVmwShares),0)","type":"formula","format":"int_4dp","propagate":{"end":"Z26"},"dataclass":"info"},
{"sheet":1,"id":"Z27","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"Z29","data":"=Z5","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AA4","data":"active amount"},
{"sheet":1,"id":"AA5","data":"=SUM(AA7:AA27)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AA7","data":"=SWITCH(Reference!$E$4,\"eTradeTransactionLog\", X7, \"eTradeHoldingRatio\", X7, \"eTradeLotQtyRatio\",Y7, \"manualLotRatio\", Z7)","type":"formula","format":"int_4dp","propagate":{"end":"AA26"},"dataclass":"info"},
{"sheet":1,"id":"AA27","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AA29","data":"=AA5","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AB3","data":"Basis adjustment for Dell dividends"},
{"sheet":1,"id":"AB4","data":"1st special divident basis adjustment"},
{"sheet":1,"id":"AB7","data":"=LET(purchaseDate,C7, dateOfRecord,Reference!$B$26, returnOfCapital,Reference!$C$26, IF(purchaseDate < dateOfRecord, returnOfCapital,0))","type":"formula","format":"financial","propagate":{"end":"AB26"},"dataclass":"info"},
{"sheet":1,"id":"AB27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AC4","data":"2nd dividend basis adjustment"},
{"sheet":1,"id":"AC7","data":"=LET(purchaseDate,C7, dateOfRecord,Reference!$B$27, returnOfCapital,Reference!$C$27, IF(purchaseDate < dateOfRecord, returnOfCapital,0))","type":"formula","format":"financial","propagate":{"end":"AC26"},"dataclass":"info"},
{"sheet":1,"id":"AC27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AD3","data":"Cost basis entering merger"},
{"sheet":1,"id":"AD4","data":"VMW tax-basis per share","note":"The cost basis is the actual price paid per share times the number of shares, plus the ordinary income on sale.\n\nWorking on the assumption that the merger does not count as a sale for non-cash lots, the basis shouldn't be adjusted here. HOWEVER.... we do want to consider the basis adjustment from the perspective of lot selection."},
{"sheet":1,"id":"AD7","data":"=LET(actualPrice,L7, firstReturnOfCapital,AB7, secondReturnOfCapital,AC7, actualPrice - firstReturnOfCapital - secondReturnOfCapital)","type":"formula","format":"financial","propagate":{"end":"AD26"},"dataclass":"info"},
{"sheet":1,"id":"AD27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AE4","data":"VMW tax-basis per lot"},
{"sheet":1,"id":"AE5","data":"=SUM(AE7:AE27)","type":"formula","format":"financial"},
{"sheet":1,"id":"AE7","data":"=AD7*D7","type":"formula","format":"financial","propagate":{"end":"AE26"},"dataclass":"info"},
{"sheet":1,"id":"AE27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AF3","data":"AVGO shares received"},
{"sheet":1,"id":"AF4","data":"eTrade pro-rata"},
{"sheet":1,"id":"AF5","data":"=SUM(AF7:AF27)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AF7","data":"=LET(numVmwShares,D7, stockRatio,Reference!$B$5, vmwToAvgoRatio,Reference!$B$6, numVmwShares * stockRatio * vmwToAvgoRatio)","type":"formula","format":"int_6dp","propagate":{"end":"AF26"},"dataclass":"info"},
{"sheet":1,"id":"AF27","format":"int_6dp","dataclass":"info"},
{"sheet":1,"id":"AF29","data":"=AF5","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AG4","data":"eTrade derived per-lot","note":"This should exactly equal the value in the \"AVGO qty from eTrade\" column as it's literally inverted the calc.\n\nThis column is here purely for consistency so we can see all three stock columns together\n"},
{"sheet":1,"id":"AG5","data":"=SUM(AG7:AG27)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AG7","data":"=LET(numVmwShares,D7, stockRatio,U7, vmwToAvgoRatio,Reference!$B$6, numVmwShares * stockRatio * vmwToAvgoRatio)","type":"formula","format":"int_6dp","propagate":{"end":"AG26"},"dataclass":"info"},
{"sheet":1,"id":"AG27","format":"int_6dp","dataclass":"info"},
{"sheet":1,"id":"AG29","data":"=AG5","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AH4","data":"manual per-lot"},
{"sheet":1,"id":"AH5","data":"=SUM(AH7:AH27)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AH7","data":"=LET(numVmwShares,D7, stockRatio,V7, vmwToAvgoRatio,Reference!$B$6, numVmwShares * stockRatio * vmwToAvgoRatio)","type":"formula","format":"int_6dp","propagate":{"end":"AH26"},"dataclass":"info"},
{"sheet":1,"id":"AH27","format":"int_6dp","dataclass":"info"},
{"sheet":1,"id":"AH29","data":"=AH5","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AI4","data":"active qty"},
{"sheet":1,"id":"AI5","data":"=SUM(AI7:AI27)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AI7","data":"=SWITCH(Reference!$E$4,\"eTradeTransactionLog\", AF7, \"eTradeHoldingRatio\", AF7, \"eTradeLotQtyRatio\",AG7, \"manualLotRatio\", AH7)","type":"formula","format":"int_6dp","propagate":{"end":"AI26"},"dataclass":"info"},
{"sheet":1,"id":"AI27","format":"int_6dp","dataclass":"info"},
{"sheet":1,"id":"AI29","data":"=AI5","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AJ3","data":"Alternate gain calculation"},
{"sheet":1,"id":"AJ4","data":"Gain (cash+FMV AVGO-basis)"},
{"sheet":1,"id":"AJ5","data":"=SUM(AJ7:AJ27)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AJ7","data":"=LET(numVmwShares,D7, vmwBasis,AD7, avgoQty,AI7, avgoFMV,Reference!$B$18, cashReceived,AA7, gain,cashReceived+(avgoQty*avgoFMV)-(numVmwShares*vmwBasis),\nMAX(gain,0))","type":"formula","format":"financial","propagate":{"end":"AJ26"},"dataclass":"info"},
{"sheet":1,"id":"AJ27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AJ29","data":"=AJ5","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AK4","data":"Fractional share"},
{"sheet":1,"id":"AK5","data":"=SUM(AK7:AK27)","type":"formula","format":"int_4dp","dataclass":"out_now"},
{"sheet":1,"id":"AK7","data":"=LET(useForFraction,N7, fractionAmount,Summary!$C$41, esppFractionLots,$N$5, rsuFractionLots,RSU!J$5, IF(useForFraction, fractionAmount / (esppFractionLots+rsuFractionLots), 0))","type":"formula","format":"int_4dp","propagate":{"end":"AK26"},"dataclass":"info"},
{"sheet":1,"id":"AK27","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AK29","data":"=AK5","type":"formula","format":"int_4dp","dataclass":"out_now"},
{"sheet":1,"id":"AL2","data":"Now"},
{"sheet":1,"id":"AL3","data":"Gain"},
{"sheet":1,"id":"AL4","data":"Fraction"},
{"sheet":1,"id":"AL5","data":"=SUM(AL7:AL27)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AL7","data":"=LET(useForFraction,N7, fractionSaleFMV,Reference!$B$23, postMergerBasis,AY7, lotFractionAmount,AK7, IF(useForFraction, (fractionSaleFMV - postMergerBasis)*lotFractionAmount, 0))","type":"formula","format":"int_4dp","propagate":{"end":"AL26"},"dataclass":"out_now"},
{"sheet":1,"id":"AL27","format":"int_4dp","dataclass":"out_now"},
{"sheet":1,"id":"AL29","data":"=AL5","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AM4","data":"Merger"},
{"sheet":1,"id":"AM5","data":"=SUM(AM7:AM27)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AM7","data":"=LET(cashReceived,AA7, alternateGainAmount,AJ7, MIN(cashReceived, alternateGainAmount))","type":"formula","format":"int_4dp","propagate":{"end":"AM26"},"dataclass":"out_now"},
{"sheet":1,"id":"AM27","format":"int_4dp","dataclass":"out_now"},
{"sheet":1,"id":"AM29","data":"=AM5","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AN4","data":"Income & short term gain","note":"This pulls in the ordinary income portion for the fractional share if associated with the lot.\n\nIf there are no AVGO shares received for the lot, then the ordinary income cannot be deferred to future sale and must be counted."},
{"sheet":1,"id":"AN5","data":"=SUM(AN7:AN27)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AN7","data":"=LET(\nimputedIncome,BB7,\navgoQty,AI7, \nperAvgoIncome, iferror(imputedIncome/avgoQty,0),\npurchaseDate,C7,\nmergerDate,Reference!$B$28,\nlotFractionAmount,AK7,\nlotFractionGain,AL7,\nmergerGain,AM7,\nshortTermGain,IF(DATEDIF(purchaseDate,mergerDate,\"Y\")>=1,\n  0,\n  lotFractionGain + mergerGain\n),\nincomeOnFraction,perAvgoIncome*lotFractionAmount, \nshortTermGain + incomeOnFraction + IF(avgoQty=0,imputedIncome-incomeOnFraction,0))","type":"formula","format":"int_4dp","propagate":{"end":"AN26"},"dataclass":"out_now"},
{"sheet":1,"id":"AN27","format":"int_4dp","dataclass":"out_now"},
{"sheet":1,"id":"AN29","data":"=AN5","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AO4","data":"Long term gain"},
{"sheet":1,"id":"AO5","data":"=SUM(AO7:AO27)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AO7","data":"=LET(\npurchaseDate,C7,\nmergerDate,Reference!$B$28,\nlotFractionGain,AL7,\nmergerGain,AM7,\nIF(DATEDIF(purchaseDate,mergerDate,\"Y\")>=1,\n  lotFractionGain+mergerGain,\n  0\n))","type":"formula","format":"int_4dp","propagate":{"end":"AO26"},"dataclass":"out_now"},
{"sheet":1,"id":"AO27","format":"int_4dp","dataclass":"out_now"},
{"sheet":1,"id":"AO29","data":"=AO5","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AP3","data":"Form 8949"},
{"sheet":1,"id":"AP4","data":"Form Section"},
{"sheet":1,"id":"AP7","data":"=IF(DATEDIF(L7,Reference!$B$28,\"Y\")>=1,\"Part II Box D\",\"Part I Box A\")","type":"formula","format":"financial","propagate":{"end":"AP26"},"dataclass":"out_now"},
{"sheet":1,"id":"AP27","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AQ4","data":"Acquisition Date"},
{"sheet":1,"id":"AQ7","data":"=C7","type":"formula","format":"iso-date","propagate":{"end":"AQ26"},"dataclass":"out_now"},
{"sheet":1,"id":"AQ27","data":"1970-01-01","format":"iso-date","dataclass":"out_now"},
{"sheet":1,"id":"AQ29","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AR4","data":"1099-B Proceeds","note":"This is the pro-rata cash portion that eTrade have used per lot and reported on the 1099-B.\n\nThis is useful to disambiguate which lot is which when there are multiple on a single date.\n"},
{"sheet":1,"id":"AR7","data":"=X7","type":"formula","format":"financial","propagate":{"end":"AR26"},"dataclass":"out_now"},
{"sheet":1,"id":"AR27","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AR29","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AS4","data":"Proceeds (d)","note":"From https://www.irs.gov/instructions/i8949\nfor Column (d)â€”Proceeds (Sales Price)\n\n\"If the proceeds you received were more than shown on Form 1099-B or 1099-S (or substitute statement), enter the correct proceeds in column (d). This might happen if, for example, box 4 on Form 1099-S is checked.\"\n\n"},
{"sheet":1,"id":"AS5","data":"=SUM(AS7:AS27)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AS7","data":"=LET(\ncashReceived,AA7, \navgoQty,AI7, \nproceedsStyle,Reference!$E$9, \navgoFMV,Reference!$B$18, \nSWITCH(proceedsStyle, \"combined\", cashReceived +(avgoQty*avgoFMV), \"cashOnly\", cashReceived))","type":"formula","format":"financial","propagate":{"end":"AS26"},"dataclass":"out_now"},
{"sheet":1,"id":"AS27","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AS29","data":"=AS5","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AS30","data":"NOTE: costbasis.com recommends attaching a statement explaining the adjustment to proceeds"},
{"sheet":1,"id":"AT4","data":"1099-B basis (e)"},
{"sheet":1,"id":"AT5","data":"=SUM(AT7:AT27)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AT7","data":"=P7","type":"formula","format":"financial","propagate":{"end":"AT26"},"dataclass":"out_now"},
{"sheet":1,"id":"AT27","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AT29","data":"=AT5","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AU4","data":"Code (f)"},
{"sheet":1,"id":"AU7","data":"=IF(AV7=0,,\"B\")","type":"formula","format":"financial","propagate":{"end":"AU26"},"dataclass":"out_now"},
{"sheet":1,"id":"AU27","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AV4","data":"Adjustment (g)","note":"Using calc from https://www.irs.gov/instructions/i8949#en_US_2022_publink1000114401\n\nIt's negative because the Form instructions require gain to be:\nd - e + g"},
{"sheet":1,"id":"AV5","data":"=SUM(AV7:AV27)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AV7","data":"=LET(\nnumVmwShares,D7, \nvmwBasis, AD7, \navgoQty,AI7, \navgoFMV,Reference!$B$18, \ncashReceived,AA7, \navgoTotalValue, avgoFMV*avgoQty, \nvmwTotalBasis, vmwBasis*numVmwShares,\nalternateGainAmount,AJ7, \nbasis1099B, AT7,\nbasis1099B - IF(cashReceived<alternateGainAmount,\n  avgoTotalValue,\n  vmwTotalBasis\n))","type":"formula","format":"financial","propagate":{"end":"AV26"},"dataclass":"out_now"},
{"sheet":1,"id":"AV27","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AV29","data":"=AV5","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AW4","data":"Gain (h)","note":"Not allowed to recognize a loss. I'm assuming that applies at a share level rather than the aggregate holding absent explicit indication otherwise."},
{"sheet":1,"id":"AW5","data":"=SUM(AW7:AW27)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AW7","data":"=LET(proceeds,AS7, basis1099B, AT7, adjustment,AV7, MAX(proceeds - basis1099B + adjustment, 0))","type":"formula","format":"financial","propagate":{"end":"AW26"},"dataclass":"out_now"},
{"sheet":1,"id":"AW27","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AW29","data":"=AW5","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AX4","data":"AVGO tax-basis per share","note":"This is the pure adjusted basis without Ordinary Income factored in.\n\nThe only time I can think of that you'd need this is if you need to give it to a broker to update basis in their systems.\n\nOn sale, you should be using the basis with Ordinary Income added in."},
{"sheet":1,"id":"AX7","data":"=LET(vmwBasis,AD7, numShares,D7, cashReceived,AA7, gainRecognized,AM7, isQualified,BA7, imputedIncome,BB7, avgoQty,AI7, IFERROR( ((vmwBasis*numShares) - cashReceived + gainRecognized)/avgoQty, \"n/a\"))","type":"formula","format":"financial","propagate":{"end":"AX26"},"dataclass":"out_future"},
{"sheet":1,"id":"AX27","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"AY2","data":"Post Merger"},
{"sheet":1,"id":"AY3","data":"Reference for sale post-merger"},
{"sheet":1,"id":"AY4","data":"AVGO basis adjusted by Ordinary Income","note":"When selling ESPP shares, the tax basis includes the reported ordinary income.\n\nSee https://github.com/hickeng/financial/issues/15#issuecomment-1947700730"},
{"sheet":1,"id":"AY7","data":"=LET(vmwBasis,AD7, numShares,D7, cashReceived,AA7, gainRecognized,AM7, isQualified,BA7, imputedIncome,BB7, avgoQty,AI7, IFERROR( ((vmwBasis*numShares) - cashReceived + gainRecognized + imputedIncome)/avgoQty, \"n/a\"))","type":"formula","format":"financial","propagate":{"end":"AY26"},"dataclass":"out_future"},
{"sheet":1,"id":"AY27","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"AY31","data":" "},
{"sheet":1,"id":"AZ4","data":"Potential Captial Gain (AVGO)"},
{"sheet":1,"id":"AZ5","data":"=SUM(AZ7:AZ27)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"AZ7","data":"=LET(saleFMV,Reference!$B$10, postMergerBasis,AY7, avgoQty,AI7, lotFractionAmount,AK7, iferror((saleFMV - postMergerBasis) * (avgoQty - lotFractionAmount), 0))","type":"formula","format":"financial","propagate":{"end":"AZ26"},"dataclass":"out_future"},
{"sheet":1,"id":"AZ27","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"AZ29","data":"=AZ5","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BA4","data":"Qualified"},
{"sheet":1,"id":"BA5","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BA7","data":"=LET(grantDate,B7, postMergerSaleDate,Reference!$B$29, purchaseBeginDate,A7, AND(DATEDIF(grantDate,postMergerSaleDate,\"Y\")>=1, DATEDIF(purchaseBeginDate, postMergerSaleDate, \"Y\")>=2))","type":"formula","format":"financial","dataclass":"info","note":"This is modified vs the repo 0.1.6 commit to correct an incorrect row reference (A9 but should have been A7).\n\nThis has been done in place in poor commit/release hygine style so that people copying this sheet from now onwards don't pick up the issue.\n\nIt'll only impact people setting post-merger sale date prior to March 1st which was the last ESPP lot qualifying transition."},
{"sheet":1,"id":"BA8","data":"=LET(grantDate,B8, postMergerSaleDate,Reference!$B$29, purchaseBeginDate,A8, AND(DATEDIF(grantDate,postMergerSaleDate,\"Y\")>=1, DATEDIF(purchaseBeginDate, postMergerSaleDate, \"Y\")>=2))","type":"formula","format":"financial","propagate":{"end":"BA26"},"dataclass":"info"},
{"sheet":1,"id":"BA27","format":"financial","dataclass":"info"},
{"sheet":1,"id":"BA29","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BB4","data":"Pending Ordinary Income"},
{"sheet":1,"id":"BB5","data":"=SUM(BB7:BB27)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BB7","data":"=LET(\nvmwBasis,AD7,\nnumVmwShares,D7,\ncashReceived,AA7,\ngainRecognized,AM7,\npureAvgoBasis,IFERROR((vmwBasis - (cashReceived + gainRecognized)/numVmwShares),0),\nisQualified,BA7,\nsaleFMV,Reference!$B$10,\nactualPrice,L7,\npurchaseDateFMV,F7,\ngrantDateFMV,E7,\ngainFromSale,(saleFMV - pureAvgoBasis),\ndisqualifiedIncome,(purchaseDateFMV - actualPrice),\nqualifiedIncome,MIN(\n   gainFromSale,\n   (0.15 * grantDateFMV)),\nincome,IF(isQualified,\n   qualifiedIncome,\n   disqualifiedIncome),\nnumVmwShares * income)","type":"formula","format":"financial","propagate":{"end":"BB26"},"dataclass":"out_future"},
{"sheet":1,"id":"BB27","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BB29","data":"=BB5","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BC4","data":"Short Term Capital Gain"},
{"sheet":1,"id":"BC5","data":"=SUM(BC7:BC27)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BC7","data":"=LET(\navgoQty,AI7, \npurchaseDate,C7,\npostMergerSaleDate,Reference!$B$29,\nsaleFMV,Reference!$B$10,\npostMergerBasis,AY7, \nIF(DATEDIF(purchaseDate,postMergerSaleDate,\"Y\")>=1,\n  0,\n  avgoQty * (saleFMV - postMergerBasis)\n))","type":"formula","format":"financial","propagate":{"end":"BC26"},"dataclass":"out_future"},
{"sheet":1,"id":"BC27","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BC29","data":"=BC5","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BD4","data":"Long Term Capital Gain"},
{"sheet":1,"id":"BD5","data":"=SUM(BD7:BD27)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BD7","data":"=LET(\navgoQty,AI7, \npurchaseDate,C7,\npostMergerSaleDate,Reference!$B$29,\nsaleFMV,Reference!$B$10,\npostMergerBasis,AY7, \nIFERROR(IF(DATEDIF(purchaseDate,postMergerSaleDate,\"Y\")>=1,\n  avgoQty * (saleFMV - postMergerBasis),\n  0\n),0))","type":"formula","format":"financial","propagate":{"end":"BD26"},"dataclass":"out_future"},
{"sheet":1,"id":"BD27","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BD29","data":"=BD5","type":"formula","format":"financial","dataclass":"out_future"},
