{"sheet":0,"id":"_","name":"ESPP","conditional_formatting":{"type":"bool","criteria":"NUMBER_NOT_EQUAL_TO","args":["=ROUND(AF7,3)","=AA7",0,0,0],"ranges":["M7:M35","AM7:AM35","AL7:AL35","AL7:AL35","O7:O35"],"effect":["background: #FCE5CD","background: #A2C4C9","background: #D0E0E3","background: #FCE5CD"]}},
{"sheet":1,"id":"A1","data":"Input"},
{"sheet":1,"id":"A2","data":"From ESPP purchase confirmation docs"},
{"sheet":1,"id":"A4","data":"Purchase Begin Date"},
{"sheet":1,"id":"A7","type":"formula","format":"iso-date","propagate":{"end":"A35"},"dataclass":"in_ref"},
{"sheet":1,"id":"B3","data":"Input "},
{"sheet":1,"id":"B4","data":"1970-01-01","format":"iso-date"},
{"sheet":1,"id":"B6","data":"Required"},
{"sheet":1,"id":"B7","format":"yyyy\"-\"mmm\"-\"dd","dataclass":"in","note":"Enter the grant date for the ESPP lots in this column.\n\nThis will be used to retrieve the market value for that date.\n\nSee https://github.com/hickeng/financial/blob/main/usage.md#espp for details"},
{"sheet":1,"id":"B8","format":"yyyy\"-\"mmm\"-\"dd","propagate":{"end":"B35"},"dataclass":"in"},
{"sheet":1,"id":"C4","data":"Purchase Date"},
{"sheet":1,"id":"C6","data":"Required"},
{"sheet":1,"id":"C7","format":"yyyy\"-\"mmm\"-\"dd","dataclass":"in","note":"Enter the Purchase Date for the ESPP lots in this column.\n\nThis will be used to retrieve the market value for that date.\n\nSee https://github.com/hickeng/financial/blob/main/usage.md#espp for details"},
{"sheet":1,"id":"C8","format":"yyyy\"-\"mmm\"-\"dd","propagate":{"end":"C35"},"dataclass":"in"},
{"sheet":1,"id":"D4","data":"Shares Purchased"},
{"sheet":1,"id":"D5","data":"=SUM(D7:D)","type":"formula","format":"int","dataclass":"info"},
{"sheet":1,"id":"D6","data":"Required"},
{"sheet":1,"id":"D7","format":"int","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"dataclass":"in","note":"Enter the number of shares from this ESPP lot that you held over the date of the merger.\n\nThis is the value from \"Shares Purchased\" and NOT from \"Total shares Purchased for Offering\". If you've sold any since release, adjust the number to reflect that.\n\nSee https://github.com/hickeng/financial/blob/main/usage.md#espp"},
{"sheet":1,"id":"D8","format":"int","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"propagate":{"end":"D35"},"dataclass":"in"},
{"sheet":1,"id":"E4","data":"Grant Date Market Value"},
{"sheet":1,"id":"E7","data":"=IF(B7<>\"\", IFERROR(VLOOKUP(B7, SORT(PriceReference!$A$1:$B), 2, TRUE), \"price unavailable\"), \"\")","type":"formula","format":"financial","propagate":{"end":"E35"},"dataclass":"info"},
{"sheet":1,"id":"F4","data":"Purchase Value per Share"},
{"sheet":1,"id":"F7","data":"=IF(C7<>\"\", IFERROR(VLOOKUP(C7, SORT(PriceReference!$A$1:$B), 2, TRUE), \"price unavailable\"), \"\")","type":"formula","format":"financial","propagate":{"end":"F35"},"dataclass":"info"},
{"sheet":1,"id":"G4","data":"Current Contributions"},
{"sheet":1,"id":"G6","data":"Optional"},
{"sheet":1,"id":"G7","format":"financial","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"dataclass":"in_opt","note":"This is an optional field to let you capture the per-offering period contribution you made.\n\nThis feeds into a set of informational calculations regarding precise dollars invested but is NOT used in the merger calc and can be safely omitted."},
{"sheet":1,"id":"G8","format":"financial","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"propagate":{"end":"G35"},"dataclass":"in_opt"},
{"sheet":1,"id":"H3","data":"Derived - informational only"},
{"sheet":1,"id":"H4","data":"Total Price"},
{"sheet":1,"id":"H5","data":"=SUM(H7:H)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"H7","data":"=D7*L7","type":"formula","format":"financial","propagate":{"end":"H35"},"dataclass":"info"},
{"sheet":1,"id":"I3","data":"Derived - should match vlaues from ESPP purchase confirmation"},
{"sheet":1,"id":"I4","data":"Previous Carry Forward"},
{"sheet":1,"id":"I6","data":"Optional"},
{"sheet":1,"id":"I7","format":"financial","dataclass":"in_opt","note":"This is an optional field to let you capture the per-offering period contribution you made.\n\nPut the Previous Carry Forward from your earliest ESPP confirmation for shares you still own into this cell and it'll propagate down.\n\nThis calc is only useful if you've kept whole lots without gaps. If not, just enter the value from the Purchase Confirmation, or omit completely - this column does NOT feed into the merger calculation."},
{"sheet":1,"id":"I8","data":"=K7","type":"formula","format":"financial","propagate":{"end":"I35"},"dataclass":"in_prepop"},
{"sheet":1,"id":"J4","data":"Total Contributions"},
{"sheet":1,"id":"J7","data":"=LET(contrib,G7, carry,I7, IF(contrib>0, carry+contrib, 0))","type":"formula","format":"financial","propagate":{"end":"J35"},"dataclass":"info"},
{"sheet":1,"id":"K4","data":"Carry Forward"},
{"sheet":1,"id":"K7","data":"=LET(totalContrib,J7,totalPrice,H7, priorCarry,I7, IF(H7>0,totalContrib-totalPrice,priorCarry))","type":"formula","format":"financial","propagate":{"end":"K35"},"dataclass":"info"},
{"sheet":1,"id":"L4","data":"Purchase Price per Share"},
{"sheet":1,"id":"L7","data":"=LET(discount,0.85, grantDateValue,E7, purchaseDateValue,F7, roundingThresholdDate,DATEVALUE(\"2016-07-30\"), purchasePrice,discount*MIN(grantDateValue,purchaseDateValue), IF(C7<roundingThresholdDate, purchasePrice, ROUND(purchasePrice,2)))","type":"formula","format":"int_4dp","propagate":{"end":"L35"},"dataclass":"info"},
{"sheet":1,"id":"M2","data":"From eTrade","format":"int_3dp"},
{"sheet":1,"id":"M3","data":"Input - alternate for cross check","format":"int_3dp"},
{"sheet":1,"id":"M4","data":"AVGO qty from eTrade","format":"int_3dp"},
{"sheet":1,"id":"M5","data":"=SUM(M7:M)","type":"formula","format":"int_3dp","dataclass":"info"},
{"sheet":1,"id":"M6","data":"Optional"},
{"sheet":1,"id":"M7","format":"int_3dp","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"dataclass":"in_opt","note":"This is an optional input.\n\nYou can use it to:\na. track the qty that etrade assocaited with the lot\nb. use a derived per-lot ratio for cash/stack from etrade's number by setting the \"Cash/stock ratio\" tweak on the Summary page to \"Pro-rata - from eTrade share qty\"\n\nThis is the quantities of converted shares from eTrade lots as reported by eTrade. The colour of the cell will alter slightly if the value here does not equal the value calculated via AVGO ratio.\n\nYou can toggle whether to use this manual value or the calculated value in the Tweaks on the first Sheet.\n\nIf this is the lot from which a fraction was taken by etrade then you should add then fractional AVGO quantity back into this value and check the Fraction box. See the note on the fraction column."},
{"sheet":1,"id":"M8","format":"int_3dp","validation":{"type":"NUMBER_GREATER_THAN_OR_EQUAL_TO","values":0,"enforced":true,"help":""},"propagate":{"end":"M35"},"dataclass":"in_opt"},
{"sheet":1,"id":"N4","data":"Use for fraction","format":"int_3dp"},
{"sheet":1,"id":"N5","data":"=COUNTIF(N7:N, TRUE)","type":"formula"},
{"sheet":1,"id":"N6","data":"Required"},
{"sheet":1,"id":"N7","type":"checkbox","format":"int_3dp","validation":{"type":"CHECKBOX","enforced":false,"help":""},"dataclass":"in","note":"Almost everyone will have a fractional AVGO share after conversion. For many people this is take from their oldest or newest lot. \n\nCheck the box for the lot the fraction was taken from and add the fractional amount back into to \"AVGO qty from eTrade\" column.\nSee the usage docs for details on how to determine the appropriate lot\n\nhttps://github.com/hickeng/financial/blob/main/usage.md#factional-share\n\n\nNotes:\nIf the fractional share should come out of a specific lot, or set of lots, check those lots here. If multiple are selected the sheet will spread the fraction equally over those lots, accounting for differences in cost-basis.\n\nIf it came out of an ESPP lot, that's a sale and will incur the ordinary income portion of tax shown in column \"Income & short term gain\".\n\nThe fractional quantity should be added back into \"AVGO qty from eTrade\" column for the lot that eTrade took it from.\nThis is done because we need the cost-basis of the lot calculated _before_ that fraction is removed as it's a serial conversion - convert entire lot, THEN sell factional part. It also avoids substantial complexity in formulae.\n"},
{"sheet":1,"id":"N8","type":"checkbox","format":"int_3dp","validation":{"type":"CHECKBOX","enforced":false,"help":""},"propagate":{"end":"N35"},"dataclass":"in"},
{"sheet":1,"id":"O2","format":"int_3dp"},
{"sheet":1,"id":"O3","data":"1099-B ","format":"int_3dp"},
{"sheet":1,"id":"O4","data":"Proceeds (1d)","format":"int_3dp"},
{"sheet":1,"id":"O7","format":"financial","propagate":{"end":"O35"},"dataclass":"in_opt"},
{"sheet":1,"id":"P2","format":"int_3dp"},
{"sheet":1,"id":"P4","data":"Cost or Other Basis (1e)","format":"int_3dp","note":"Pre-filled with 0.00 because that's what eTrade has reported for everyone."},
{"sheet":1,"id":"P7","format":"financial","propagate":{"end":"P35"},"dataclass":"in_opt"},
{"sheet":1,"id":"Q2","format":"int_3dp"},
{"sheet":1,"id":"Q4","data":"Accrued Market Discount (1f)","format":"int_3dp"},
{"sheet":1,"id":"Q7","format":"financial","propagate":{"end":"Q35"},"dataclass":"in_opt"},
{"sheet":1,"id":"R2","format":"int_3dp"},
{"sheet":1,"id":"R4","data":"Wash Sale Loss Disallowed (1g)","format":"int_3dp"},
{"sheet":1,"id":"R7","format":"financial","propagate":{"end":"R35"},"dataclass":"in_opt"},
{"sheet":1,"id":"S2","format":"int_3dp"},
{"sheet":1,"id":"S4","data":"Gain/Loss Amount","format":"int_3dp"},
{"sheet":1,"id":"S7","format":"financial","propagate":{"end":"S35"},"dataclass":"in_opt"},
{"sheet":1,"id":"T2","format":"int_3dp"},
{"sheet":1,"id":"T4","data":"Federal Income Tax Withheld (4)","format":"int_3dp"},
{"sheet":1,"id":"T7","format":"financial","propagate":{"end":"T35"},"dataclass":"in_opt"},
{"sheet":1,"id":"U2","format":"int_3dp"},
{"sheet":1,"id":"U3","data":"Ratio (shares)","format":"int_3dp"},
{"sheet":1,"id":"U4","data":"Derived from manual share qty","format":"int_3dp","note":"This value is calculated from the VMW -> AVGO ratio for the lot\n"},
{"sheet":1,"id":"U7","data":"=iferror(M7/(0.252*D7),0)","type":"formula","format":"int_6dp","propagate":{"end":"U35"},"dataclass":"info"},
{"sheet":1,"id":"V4","data":"Manual per-lot","format":"int_3dp","note":"Manual user entry per lot if using a per-lot election instead of pro-rata\n"},
{"sheet":1,"id":"V7","data":"=SWITCH(W7,\"cash\",Reference!$E$5,\"shares\",Reference!$E$6,\"balance\",Reference!$E$7,\"pro-rata\",Reference!$B$5)","type":"formula","format":"int_6dp","propagate":{"end":"V35"},"dataclass":"info"},
{"sheet":1,"id":"W4","data":"Prefer","format":"int_3dp"},
{"sheet":1,"id":"W6","data":"Optional"},
{"sheet":1,"id":"W7","type":"dropdown","format":"int_6dp","validation":{"type":"VALUE_IN_LIST","values":["balance","cash","shares","pro-rata"],"enforced":true,"help":""},"dataclass":"in_opt","note":"This is an optional field.\n\nThe value selected here will only reflect in the wider sheet if the \"Per-lot - from strategy or manual selection\" has been selected for the ratio source in the Tweaks on the Summary sheet."},
{"sheet":1,"id":"W8","type":"dropdown","format":"int_6dp","validation":{"type":"VALUE_IN_LIST","values":["balance","cash","shares","pro-rata"],"enforced":true,"help":""},"propagate":{"end":"W35"},"dataclass":"in_opt"},
{"sheet":1,"id":"X1","data":"Output"},
{"sheet":1,"id":"X2","data":"Calculated"},
{"sheet":1,"id":"X3","data":"Cash received"},
{"sheet":1,"id":"X4","data":"eTrade pro-rata"},
{"sheet":1,"id":"X5","data":"=SUM(X7:X)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"X7","data":"=LET(numVmwShares,D7, cashRatio,Reference!$B$4, vmwFinalPrice,Reference!$B$3, numVmwShares * cashRatio * vmwFinalPrice)","type":"formula","format":"int_4dp","propagate":{"end":"X35"},"dataclass":"info"},
{"sheet":1,"id":"Y4","data":"derived eTrade per-lot"},
{"sheet":1,"id":"Y5","data":"=SUM(Y7:Y)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"Y7","data":"=iferror(LET(numVmwShares,$D7, stockRatio,U7, vmwFinalPrice,Reference!$B$3, (1 - stockRatio) * vmwFinalPrice * numVmwShares),0)","type":"formula","format":"int_4dp","propagate":{"end":"Y35"},"dataclass":"info"},
{"sheet":1,"id":"Z4","data":"manual per-lot"},
{"sheet":1,"id":"Z5","data":"=SUM(Z7:Z)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"Z7","data":"=iferror(LET(numVmwShares,$D7, stockRatio,V7, vmwFinalPrice,Reference!$B$3, (1 - stockRatio) * vmwFinalPrice * numVmwShares),0)","type":"formula","format":"int_4dp","propagate":{"end":"Z35"},"dataclass":"info"},
{"sheet":1,"id":"AA4","data":"active amount"},
{"sheet":1,"id":"AA5","data":"=SUM(AA7:AA)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AA7","data":"=SWITCH(Reference!$E$4,\"eTradeTransactionLog\", X7, \"eTradeHoldingRatio\", X7, \"eTradeLotQtyRatio\",Y7, \"manualLotRatio\", Z7)","type":"formula","format":"int_4dp","propagate":{"end":"AA35"},"dataclass":"info"},
{"sheet":1,"id":"AB3","data":"Basis adjustment for Dell dividends"},
{"sheet":1,"id":"AB4","data":"1st special divident basis adjustment"},
{"sheet":1,"id":"AB7","data":"=LET(purchaseDate,C7, dateOfRecord,Reference!$B$26, returnOfCapital,Reference!$C$26, IF(purchaseDate < dateOfRecord, returnOfCapital,0))","type":"formula","format":"financial","propagate":{"end":"AB35"},"dataclass":"info"},
{"sheet":1,"id":"AC4","data":"2nd dividend basis adjustment"},
{"sheet":1,"id":"AC7","data":"=LET(purchaseDate,C7, dateOfRecord,Reference!$B$27, returnOfCapital,Reference!$C$27, IF(purchaseDate < dateOfRecord, returnOfCapital,0))","type":"formula","format":"financial","propagate":{"end":"AC35"},"dataclass":"info"},
{"sheet":1,"id":"AD3","data":"Cost basis entering merger"},
{"sheet":1,"id":"AD4","data":"VMW tax-basis per share","note":"The cost basis is the actual price paid per share times the number of shares, plus the ordinary income on sale.\n\nWorking on the assumption that the merger does not count as a sale for non-cash lots, the basis shouldn't be adjusted here. HOWEVER.... we do want to consider the basis adjustment from the perspective of lot selection."},
{"sheet":1,"id":"AD7","data":"=LET(actualPrice,L7, firstReturnOfCapital,AB7, secondReturnOfCapital,AC7, actualPrice - firstReturnOfCapital - secondReturnOfCapital)","type":"formula","format":"financial","propagate":{"end":"AD35"},"dataclass":"info"},
{"sheet":1,"id":"AE4","data":"VMW tax-basis per lot"},
{"sheet":1,"id":"AE5","data":"=SUM(AE7:AE)","type":"formula","format":"financial"},
{"sheet":1,"id":"AE7","data":"=AD7*D7","type":"formula","format":"financial","propagate":{"end":"AE35"},"dataclass":"info"},
{"sheet":1,"id":"AF3","data":"AVGO shares received"},
{"sheet":1,"id":"AF4","data":"eTrade pro-rata"},
{"sheet":1,"id":"AF5","data":"=SUM(AF7:AF)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AF7","data":"=LET(numVmwShares,D7, stockRatio,Reference!$B$5, vmwToAvgoRatio,Reference!$B$6, numVmwShares * stockRatio * vmwToAvgoRatio)","type":"formula","format":"int_6dp","propagate":{"end":"AF35"},"dataclass":"info"},
{"sheet":1,"id":"AG4","data":"eTrade derived per-lot","note":"This should exactly equal the value in the \"AVGO qty from eTrade\" column as it's literally inverted the calc.\n\nThis column is here purely for consistency so we can see all three stock columns together\n"},
{"sheet":1,"id":"AG5","data":"=SUM(AG7:AG)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AG7","data":"=LET(numVmwShares,D7, stockRatio,U7, vmwToAvgoRatio,Reference!$B$6, numVmwShares * stockRatio * vmwToAvgoRatio)","type":"formula","format":"int_6dp","propagate":{"end":"AG35"},"dataclass":"info"},
{"sheet":1,"id":"AH4","data":"manual per-lot"},
{"sheet":1,"id":"AH5","data":"=SUM(AH7:AH)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AH7","data":"=LET(numVmwShares,D7, stockRatio,V7, vmwToAvgoRatio,Reference!$B$6, numVmwShares * stockRatio * vmwToAvgoRatio)","type":"formula","format":"int_6dp","propagate":{"end":"AH35"},"dataclass":"info"},
{"sheet":1,"id":"AI4","data":"active qty"},
{"sheet":1,"id":"AI5","data":"=SUM(AI7:AI)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"AI7","data":"=SWITCH(Reference!$E$4,\"eTradeTransactionLog\", AF7, \"eTradeHoldingRatio\", AF7, \"eTradeLotQtyRatio\",AG7, \"manualLotRatio\", AH7)","type":"formula","format":"int_6dp","propagate":{"end":"AI35"},"dataclass":"info"},
{"sheet":1,"id":"AJ3","data":"Alternate gain calculation"},
{"sheet":1,"id":"AJ4","data":"Gain (cash+FMV AVGO-basis)"},
{"sheet":1,"id":"AJ5","data":"=SUM(AJ7:AJ)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AJ7","data":"=LET(numVmwShares,D7, vmwBasis,AD7, avgoQty,AI7, avgoFMV,Reference!$B$18, cashReceived,AA7, gain,cashReceived+(avgoQty*avgoFMV)-(numVmwShares*vmwBasis),\nMAX(gain,0))","type":"formula","format":"financial","propagate":{"end":"AJ35"},"dataclass":"info"},
{"sheet":1,"id":"AK4","data":"Fractional share"},
{"sheet":1,"id":"AK5","data":"=SUM(AK7:AK)","type":"formula","format":"int_4dp","dataclass":"out_now"},
{"sheet":1,"id":"AK7","data":"=LET(useForFraction,N7, fractionAmount,Summary!$C$41, esppFractionLots,$N$5, rsuFractionLots,RSU!J$5, IF(useForFraction, fractionAmount / (esppFractionLots+rsuFractionLots), 0))","type":"formula","format":"int_4dp","propagate":{"end":"AK35"},"dataclass":"info"},
{"sheet":1,"id":"AL2","data":"Now"},
{"sheet":1,"id":"AL3","data":"Gain"},
{"sheet":1,"id":"AL4","data":"Fraction"},
{"sheet":1,"id":"AL5","data":"=SUM(AL7:AL)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AL7","data":"=LET(useForFraction,N7, fractionSaleFMV,Reference!$B$23, postMergerBasis,AY7, lotFractionAmount,AK7, IF(useForFraction, (fractionSaleFMV - postMergerBasis)*lotFractionAmount, 0))","type":"formula","format":"int_4dp","propagate":{"end":"AL35"},"dataclass":"out_now"},
{"sheet":1,"id":"AM4","data":"Merger"},
{"sheet":1,"id":"AM5","data":"=SUM(AM7:AM)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"AM7","data":"=LET(cashReceived,AA7, alternateGainAmount,AJ7, numAvgo,AI7, imputedIncome,BB7, MIN(cashReceived, alternateGainAmount) - IF(numAvgo=0,imputedIncome,0))","type":"formula","format":"int_4dp","dataclass":"out_now","note":"This is the gain realized for the lot.\n\nThe cell will be shaded in a darker blue if the alternative gain calculation from Form 8937 applies. The standard blue means the gain realized is amount of cash received for the lot."},
{"sheet":1,"id":"AM8","data":"=LET(cashReceived,AA8, alternateGainAmount,AJ8, numAvgo,AI8, imputedIncome,BB8, MIN(cashReceived, alternateGainAmount) - IF(numAvgo=0,imputedIncome,0))","type":"formula","format":"int_4dp","propagate":{"end":"AM35"},"dataclass":"out_now"},
{"sheet":1,"id":"AN4","data":"Income & short term gain","note":"This pulls in the ordinary income portion for the fractional share if associated with the lot.\n\nIf there are no AVGO shares received for the lot, then the ordinary income cannot be deferred to future sale and must be counted."},
{"sheet":1,"id":"AN5","data":"=SUM(AN7:AN)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AN7","data":"=IFERROR(LET(\nimputedIncome,BB7,\navgoQty,AI7, \nperAvgoIncome, iferror(imputedIncome/avgoQty,0),\npurchaseDate,C7,\nmergerDate,Reference!$B$28,\nlotFractionAmount,AK7,\nlotFractionGain,AL7,\nmergerGain,AM7,\nshortTermGain,IF(DATEDIF(purchaseDate,mergerDate,\"Y\")>=1,\n  0,\n  lotFractionGain + mergerGain\n),\nincomeOnFraction,perAvgoIncome*lotFractionAmount, \nshortTermGain + incomeOnFraction + IF(avgoQty=0,imputedIncome-incomeOnFraction,0)),0)","type":"formula","format":"int_4dp","propagate":{"end":"AN35"},"dataclass":"out_now"},
{"sheet":1,"id":"AO4","data":"Long term gain"},
{"sheet":1,"id":"AO5","data":"=SUM(AO7:AO)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AO7","data":"=IFERROR(\nLET(\npurchaseDate,C7,\nmergerDate,Reference!$B$28,\nlotFractionGain,AL7,\nmergerGain,AM7,\nIF(DATEDIF(purchaseDate,mergerDate,\"Y\")>=1,\n  lotFractionGain+mergerGain,\n  0\n)),0)","type":"formula","format":"int_4dp","propagate":{"end":"AO35"},"dataclass":"out_now"},
{"sheet":1,"id":"AP3","data":"Form 8949"},
{"sheet":1,"id":"AP4","data":"Form Section"},
{"sheet":1,"id":"AP7","data":"=IF(DATEDIF(L7,Reference!$B$28,\"Y\")>=1,\"Part II Box D\",\"Part I Box A\")","type":"formula","format":"financial","propagate":{"end":"AP35"},"dataclass":"out_now"},
{"sheet":1,"id":"AQ4","data":"Acquisition Date"},
{"sheet":1,"id":"AQ7","data":"=C7","type":"formula","format":"iso-date","propagate":{"end":"AQ35"},"dataclass":"out_now"},
{"sheet":1,"id":"AR4","data":"1099-B Proceeds","note":"This is the pro-rata cash portion that eTrade have used per lot and reported on the 1099-B.\n\nThis is useful to disambiguate which lot is which when there are multiple on a single date.\n"},
{"sheet":1,"id":"AR7","data":"=X7","type":"formula","format":"financial","propagate":{"end":"AR35"},"dataclass":"out_now"},
{"sheet":1,"id":"AS4","data":"Proceeds (d)","note":"From https://www.irs.gov/instructions/i8949\nfor Column (d)—Proceeds (Sales Price)\n\n\"If the proceeds you received were more than shown on Form 1099-B or 1099-S (or substitute statement), enter the correct proceeds in column (d). This might happen if, for example, box 4 on Form 1099-S is checked.\"\n\n"},
{"sheet":1,"id":"AS5","data":"=SUM(AS7:AS)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AS6","data":"NOTE: costbasis.com recommends attaching a statement explaining adjustment to proceeds"},
{"sheet":1,"id":"AS7","data":"=LET(\ncashReceived,AA7, \navgoQty,AI7, \nproceedsStyle,Reference!$E$9, \navgoFMV,Reference!$B$18, \nSWITCH(proceedsStyle, \"combined\", cashReceived +(avgoQty*avgoFMV), \"cashOnly\", cashReceived))","type":"formula","format":"financial","propagate":{"end":"AS35"},"dataclass":"out_now"},
{"sheet":1,"id":"AT4","data":"1099-B basis (e)"},
{"sheet":1,"id":"AT5","data":"=SUM(AT7:AT)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AT7","data":"=P7","type":"formula","format":"financial","propagate":{"end":"AT35"},"dataclass":"out_now"},
{"sheet":1,"id":"AU4","data":"Code (f)"},
{"sheet":1,"id":"AU7","data":"=IF(AV7=0,,\"B\")","type":"formula","format":"financial","propagate":{"end":"AU35"},"dataclass":"out_now"},
{"sheet":1,"id":"AV4","data":"Adjustment (g)","note":"Using calc from https://www.irs.gov/instructions/i8949#en_US_2022_publink1000114401\n\nIt's negative because the Form instructions require gain to be:\nd - e + g"},
{"sheet":1,"id":"AV5","data":"=SUM(AV7:AV)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AV7","data":"=LET(\nproceedsStyle,Reference!$E$9,\nproceeds,AS7,\ngain,AW7,\nnumVmwShares,D7, \nvmwBasis, AD7, \navgoQty,AI7, \navgoFMV,Reference!$B$18, \ncashReceived,AA7, \navgoTotalValue, avgoFMV*avgoQty, \nvmwTotalBasis, vmwBasis*numVmwShares,\nalternateGainAmount,AJ7, \nbasis1099B, AT7,\nSWITCH(proceedsStyle,\n  \"cashOnly\",\n    gain - proceeds + basis1099B,\n  \"combined\",\n    basis1099B - IF(cashReceived<alternateGainAmount,\n      avgoTotalValue,\n      vmwTotalBasis\n  )\n))","type":"formula","format":"financial","propagate":{"end":"AV35"},"dataclass":"out_now"},
{"sheet":1,"id":"AW4","data":"Gain (h)","note":"Not allowed to recognize a loss. I'm assuming that applies at a share level rather than the aggregate holding absent explicit indication otherwise."},
{"sheet":1,"id":"AW5","data":"=SUM(AW7:AW)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AW7","data":"=LET(proceedsStyle,Reference!$E$9, proceeds,AS7, basis1099B, AT7, adjustment,AV7, SWITCH(proceedsStyle, \"cashOnly\", AM7, \"combined\", MAX(proceeds - basis1099B + adjustment, 0)))","type":"formula","format":"financial","propagate":{"end":"AW35"},"dataclass":"out_now"},
{"sheet":1,"id":"AX4","data":"AVGO tax-basis per share","note":"This is the pure adjusted basis without Ordinary Income factored in.\n\nThe only time I can think of that you'd need this is if you need to give it to a broker to update basis in their systems.\n\nOn sale, you should be using the basis with Ordinary Income added in."},
{"sheet":1,"id":"AX7","data":"=LET(vmwBasis,AD7, numShares,D7, cashReceived,AA7, gainRecognized,AM7, isQualified,BA7, imputedIncome,BB7, avgoQty,AI7, IFERROR( ((vmwBasis*numShares) - cashReceived + gainRecognized)/avgoQty, \"n/a\"))","type":"formula","format":"financial","propagate":{"end":"AX35"},"dataclass":"out_future"},
{"sheet":1,"id":"AY2","data":"Post Merger"},
{"sheet":1,"id":"AY3","data":"Reference for sale post-merger"},
{"sheet":1,"id":"AY4","data":"AVGO basis adjusted by Ordinary Income","note":"When selling ESPP shares, the tax basis includes the reported ordinary income.\n\nSee https://github.com/hickeng/financial/issues/15#issuecomment-1947700730"},
{"sheet":1,"id":"AY7","data":"=LET(vmwBasis,AD7, numShares,D7, cashReceived,AA7, gainRecognized,AM7, isQualified,BA7, imputedIncome,BB7, avgoQty,AI7, IFERROR( ((vmwBasis*numShares) - cashReceived + gainRecognized + imputedIncome)/avgoQty, \"n/a\"))","type":"formula","format":"financial","propagate":{"end":"AY35"},"dataclass":"out_future"},
{"sheet":1,"id":"AZ4","data":"Potential Captial Gain (AVGO)"},
{"sheet":1,"id":"AZ5","data":"=SUM(AZ7:AZ)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"AZ7","data":"=LET(saleFMV,Reference!$B$10, postMergerBasis,AY7, avgoQty,AI7, lotFractionAmount,AK7, iferror((saleFMV - postMergerBasis) * (avgoQty - lotFractionAmount), 0))","type":"formula","format":"financial","propagate":{"end":"AZ35"},"dataclass":"out_future"},
{"sheet":1,"id":"BA4","data":"Qualified"},
{"sheet":1,"id":"BA5","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BA7","data":"=LET(grantDate,B7, postMergerSaleDate,Reference!$B$29, purchaseBeginDate,A7, AND(DATEDIF(grantDate,postMergerSaleDate,\"Y\")>=1, DATEDIF(purchaseBeginDate, postMergerSaleDate, \"Y\")>=2))","type":"formula","format":"financial","propagate":{"end":"BA35"},"dataclass":"info"},
{"sheet":1,"id":"BB4","data":"Pending Ordinary Income"},
{"sheet":1,"id":"BB5","data":"=SUM(BB7:BB)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BB7","data":"=LET(\nvmwBasis,AD7,\nnumVmwShares,D7,\ncashReceived,AA7,\ngainRecognized,AM7,\npureAvgoBasis,AX7,\nisQualified,BA7,\nsaleFMV,Reference!$B$10,\nactualPrice,L7,\npurchaseDateFMV,F7,\ngrantDateFMV,E7,\ngainFromSale,IFERROR(saleFMV - pureAvgoBasis, 0),\ndisqualifiedIncome,(purchaseDateFMV - actualPrice),\nqualifiedIncome,MIN(\n   gainFromSale,\n   (0.15 * grantDateFMV)),\nincome,IF(isQualified,\n   qualifiedIncome,\n   disqualifiedIncome),\nnumVmwShares * income)","type":"formula","format":"financial","propagate":{"end":"BB35"},"dataclass":"out_future"},
{"sheet":1,"id":"BC4","data":"Short Term Capital Gain"},
{"sheet":1,"id":"BC5","data":"=SUM(BC7:BC)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BC7","data":"=LET(\navgoQty,AI7, \npurchaseDate,C7,\npostMergerSaleDate,Reference!$B$29,\nsaleFMV,Reference!$B$10,\npostMergerBasis,AY7, \nIF(DATEDIF(purchaseDate,postMergerSaleDate,\"Y\")>=1,\n  0,\n  avgoQty * (saleFMV - postMergerBasis)\n))","type":"formula","format":"financial","propagate":{"end":"BC35"},"dataclass":"out_future"},
{"sheet":1,"id":"BD4","data":"Long Term Capital Gain"},
{"sheet":1,"id":"BD5","data":"=SUM(BD7:BD)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"BD7","data":"=LET(\navgoQty,AI7, \npurchaseDate,C7,\npostMergerSaleDate,Reference!$B$29,\nsaleFMV,Reference!$B$10,\npostMergerBasis,AY7, \nIFERROR(IF(DATEDIF(purchaseDate,postMergerSaleDate,\"Y\")>=1,\n  avgoQty * (saleFMV - postMergerBasis),\n  0\n),0))","type":"formula","format":"financial","propagate":{"end":"BD35"},"dataclass":"out_future"},
